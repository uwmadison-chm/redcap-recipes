---
title: "EMA Schedule Builder"
description: "Interactive tool for generating REDCap EMA schedule configurations"
format:
  html:
    toc: true
    toc-location: left
    code-copy: false
    resources:
      - assets/*
include-in-header:
  - text: |
      <script src="assets/jszip.min.js"></script>
---

::: {.callout-warning title="This tool is experimental!"}
Before importing generated files into an existing REDCap project, **back up your data dictionary, events, event mappings, and ASIs**. Test imports in a development project first.
:::

::: {.callout-note}
This builder runs entirely in your browser. No data leaves your machine.
:::

## 1. Project Import (Optional)

Upload an existing REDCap project XML to extract existing configuration. This helps when modifying an existing EMA setup.

<div class="mb-3">
  <label for="xml-file" class="form-label">REDCap Project XML</label>
  <input type="file" class="form-control" id="xml-file" accept=".xml">
</div>

<div id="project-info"></div>

## 2. Basic Configuration

::: {.grid}
::: {.g-col-6}
<div class="mb-3">
  <label for="start-field" class="form-label">Start date/time field</label>
  <input type="text" class="form-control" id="start-field" value="ema_start_at" placeholder="Field containing EMA start date">
</div>

<div class="mb-3">
  <label for="config-form" class="form-label">Config form name</label>
  <input type="text" class="form-control" id="config-form" value="ema_setup" placeholder="Form for EMA config fields">
</div>

<div class="mb-3">
  <label for="asi-survey-form" class="form-label">EMA survey form name</label>
  <input type="text" class="form-control" id="asi-survey-form" value="ema" placeholder="Survey form to deliver">
</div>
:::

::: {.g-col-6}
<div class="mb-3">
  <label for="event-prefix" class="form-label">Event prefix</label>
  <input type="text" class="form-control" id="event-prefix" value="ema" placeholder="e.g., ema">
</div>

<div class="mb-3">
  <label for="deliver-at-prefix" class="form-label">Deliver-at field prefix</label>
  <input type="text" class="form-control" id="deliver-at-prefix" value="ema_deliver_at" placeholder="e.g., ema_deliver_at">
</div>

<div class="mb-3">
  <label for="arm-num" class="form-label">Arm number</label>
  <input type="number" class="form-control" id="arm-num" value="1" min="1" step="1">
</div>
:::
:::

### Additional Settings

::: {.grid}
::: {.g-col-6}
<div class="mb-3">
  <label for="rand-prefix" class="form-label">PRNG field prefix</label>
  <input type="text" class="form-control" id="rand-prefix" value="rand">
</div>

<div class="mb-3">
  <label for="seed-field" class="form-label">Seed input field</label>
  <input type="text" class="form-control" id="seed-field" value="seed_input">
</div>

<div class="mb-3">
  <label for="enrollment-event" class="form-label">Enrollment event</label>
  <input type="text" class="form-control" id="enrollment-event" value="enrollment">
</div>
:::
::: {.g-col-6}
<div class="mb-3">
  <label for="field-name-a" class="form-label">Field name for 'a'</label>
  <input type="text" class="form-control" id="field-name-a" value="a">
</div>

<div class="mb-3">
  <label for="field-name-c" class="form-label">Field name for 'c'</label>
  <input type="text" class="form-control" id="field-name-c" value="c">
</div>

<div class="mb-3">
  <label for="field-name-m" class="form-label">Field name for 'm'</label>
  <input type="text" class="form-control" id="field-name-m" value="m">
</div>
:::
:::

## 3. Define Periods

Periods are the time windows during which EMA samples can be scheduled. Each sample will be randomly placed within its assigned period.

<div id="periods-container"></div>

<button id="add-period-btn" class="btn btn-outline-primary mt-2">Add Period</button>

## 4. Sample Schedule

Generate a schedule with a fixed number of days and samples per day.

<div class="d-flex align-items-end gap-3 mb-3">
<div>
<label for="num-days" class="form-label">Number of days</label>
<input type="number" class="form-control" id="num-days" value="7" min="1" max="30" step="1" style="width: 120px;">
</div>
<div>
<label for="samples-per-day" class="form-label">Samples per day</label>
<input type="number" class="form-control" id="samples-per-day" value="2" min="1" max="10" step="1" style="width: 120px;">
</div>
<div>
<button id="generate-btn" class="btn btn-primary">Generate Schedule</button>
</div>
</div>

### Generated Schedule

<div id="samples-container"></div>

## 5. ASI Settings

Configure how survey invitations will be sent.

::: {.grid}
::: {.g-col-6}
<div class="mb-3">
  <label for="asi-sender" class="form-label">Sender email</label>
  <input type="text" class="form-control" id="asi-sender" value="noreply@example.edu" placeholder="sender@institution.edu">
</div>
:::
::: {.g-col-6}
<div class="mb-3">
  <label for="asi-logic" class="form-label">Trigger logic</label>
  <input type="text" class="form-control" id="asi-logic" value='[email] <> ""' placeholder='e.g., [email] <> ""'>
</div>
:::
:::

<div class="mb-3">
  <label for="asi-subject" class="form-label">Email subject</label>
  <input type="text" class="form-control" id="asi-subject" value="EMA Survey: [event-name]" placeholder="Subject (supports REDCap piping)">
</div>

<div class="mb-3">
  <label for="asi-body" class="form-label">Email body</label>
  <textarea class="form-control" id="asi-body" rows="3"><p>Please complete your EMA survey:</p>
<p>[survey-link]</p></textarea>
</div>

## 6. Download Files

<div id="download-buttons" class="mb-3"></div>

<div class="mb-3">
<label class="form-label">Preview</label>
<div class="btn-group" role="group" aria-label="Preview selection">
<input type="radio" class="btn-check" name="preview-tab" id="preview-dictionary" value="dictionary" checked>
<label class="btn btn-outline-secondary" for="preview-dictionary">Data Dictionary</label>
<input type="radio" class="btn-check" name="preview-tab" id="preview-events" value="events">
<label class="btn btn-outline-secondary" for="preview-events">Events</label>
<input type="radio" class="btn-check" name="preview-tab" id="preview-mappings" value="mappings">
<label class="btn btn-outline-secondary" for="preview-mappings">Event Mappings</label>
<input type="radio" class="btn-check" name="preview-tab" id="preview-asis" value="asis">
<label class="btn btn-outline-secondary" for="preview-asis">ASIs</label>
</div>
</div>

<div id="preview-container"></div>

<script type="module">
import { init } from './assets/schedule-builder.js';
init();
</script>
